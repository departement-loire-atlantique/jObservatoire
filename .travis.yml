env:
  global:
  - secure: AeF67FRnEFRNX8XyfrGuvDoMJBuVmBKLVxePKmBy07FZYGiWmSmPWwFScy8Z6+RmwlwuGXwH2tlKmMYQj6Qtb+mWz+mBv74gOPQ4DemFvd2p7sdOhN2n4FUeaXp3X0s2a2xM09nyaFottoHVfZA2wVne1Ba34VYjfAkSIruyM4NZyybUhtNWBLvIrSxR24PLVQ1tv8GBOL/07ZAVzY4QDTC6azL5sufQtyetZ/xneTzQXa2nl+jeQonRh0Kczb1yjXcSqoqdyEPaLtXkYjbmaU+Bh1xjTg9Qjr2c6NtpxxMk9u/rEaQvOf2Q9RGA3kmyrPv1UKLiMnh+NnncQPRU3EA4Afd7Y0hRXa3hlf3d6h1zO7VrH00MwR7qve4f2R9B4Nh22HjaWdIfh2Pl065gkWvUuf4EbviFKELo5rG7MIS/lPDK86EasUlFQ8kB39yypeSgNG5oT0h1NgLSs+qUFxZMlmPSJsoqUacajEXnRnz75EMYyYMvcp+QGql+FhK5A3N0Oehi35oaVgKC4ZjTJKhYzhqAQeWYkZrMnOcPyKKlmJbPqNqsTy5X1yn079TanjDar4ZzAneCRlxyNC9Cp5oZ3K1WkBKg4JRyWZat+0LrZvP8hvfzbDrShwoDS7fyXCfyfT31zCnUDuCD45IL4iICasJ8rLi9GZinixlxj7I=
  - secure: VXj164pnZeUDv46HkkuCNA3ZqhnhdHdiS5kR9X1cdFsRUSSmMAMZWL5jmfg4QWUSrGvYFuyoNQtVNNNY7q6Wdu+aABTg0/5nkSteMsASQPyCLTGLYphQ+XSz1wwGHd94wYWAx6SOClQk+X8JOz5DmF6T+fW4AMQ9yCQQx1JDc/2dPsTcGpVT3YP2gROy4Fu8gOIeSd2E43ZeFb3pE0iYcILJvAd/5roTu7DELmBr2SBXuB2jh/ttvCVQpKw6m2h/B8qDogSTQ/cZvjoaxMIXwoA6oSmnamXu7NUYaJ9tJOJ1NqA5Yr5HubPMsYA1putzFN5ueW7RSU2lJeGY531noF2ylZ0mvlfERgKx8PwYqweNEkGvjWK801ZPo49mxCpNjnv3g6gG8PMs8EBVD0DBi1I4Gkzrqo2E5nFkwKHp5dsIlwwGHBOzXp0eCafJtOyRE2ikD8iqf64SM+wTd7mlx+8eYKs7jmd66spuNAxEJQcMl8/a+gwFiHrEh5o2y3R6iq9luN1XTT/g48vl+U5/ImhjjpvA4pMXTQ8867DL81bOa3Xren+2S8JD/4QNzUQ1zgDLg9peHcdsOekYPIEgaxb9JkODe+PklcvEQv2KcNBrUMNbXEEOJW9b4eFLXcvB/MjSVLYvOgbpU/6Mlgo1wjFIwTTEZ57R2uLWyRTdiXQ=

services:
- docker

addons:
  sonarcloud:
    organization: departement-loire-atlantique
    token:
      secure: M+8vAHlAT0EB4byV3wLQcWKiZF/JmolYEd7GDydRwAXBqWZsCNmWh80C0Nr2o4OhQpHrvSe3MROD4ZAH8gYAaWYZwaFm00NLLrjW1yb3rx0ExgeuSS5tzmjujSf61hbQaKw+3u2nDZMWaANfti4a5Cur9tFEcLXt2SAhNWV9jWxXb2cHrNdcT22qKigXrzJBWeAwvcKqCcKKGPoMfiMVcMqTb7caMRImIpleniRFQ/kjhOVrE10Qj/IyHgR34a8IBLBGvjJVNkCmYNMJ4IIOXjZl4QxJo68PvkXqToD7+bSZRp2GD1yaOFY4yr+Qu9L8ZlPgJ5D2VuPfYgUAGkBLt+p5SOP34a40H3OHTjxBaA4xCF3oswdO9w0zriNjgw+Fxn3XjGYWwpcrP69uZPDpgBAY9xTzFeZQA15HCqqKObe352FbXcYg4vuqKbGIcnUVobPXBicjGhgWzQMI/LWHb5aDRyOaUJL3UfPv0yKr55Re2VvqLg4zc52oNu6kuPT+dEWig9i5GEhQjTbLdMdZfGGk+++95PS9c39hp19cBYcjbcM6PdGYHWf/lKfi9qk7JZTXYoaso0eiS2Nm2gnYD9boPODSBlhWV+gQC0HyJjNKJ/79wYLqYRqXddHVqJiF5NdbuYZsH18Wilu1ssMshuMncTZ5c140GWHpsplKtYA=

before_script:
- echo "$DOCKER_PASS" | docker login --username $DOCKER_USER --password-stdin
- docker pull julienbayle/jplatformbuild

script:
- docker run -v ${TRAVIS_BUILD_DIR}:/root/source --name buildimage -t julienbayle/jplatformbuild
- docker cp buildimage:/root/dist .
- export CODE_VERSION=`git describe`
- sonar-scanner -Dsonar.projectVersion=$CODE_VERSION

deploy:
  provider: releases
  api_key:
    secure: Ct5zrGSgvMRPrif11NWtkWwVwAAeG58Ap4WGF/Sp9PSLF9Qr68WZADDNLE+2YNEYueKYdLhTPtYydZN7BeexgDMmYYOEAGBifqTWZVm3HYrfKCxysJjXtxztSOq5mkBXacG7e4B6TEGjPotQWEvtt/HfvXMgeDGUC27svI3OW4nc+7qoPKFUMV2a9dPZxO513YJe60uRsK1iyI6HEp8lajmZHe5L6514ZBrwnhMji3biebuezOT9bQnoWNFHI0KjHS1oaugo5/4eJqb83Lc+P6G9wPUgHAG2yCtor90rRJDGaNnNcg7OIGsLpTgIDaTakpGjfvd2xbTGrQEYhCi77BDB2/2efea7Ol5JnE2KzZPXdaz3vaZb5Y46CGs22msN9WXz/Owd04Zb7mTl+NJub+snL7SZQXQbRwqExjiWUkou3Do5YHqbSTIBxnlfP80NXkz7GYdvsYhUwNBSWMWnqdrz5VRfZFeXXGCkOSCqELZ3bQTpNrdsuXHG2w+hpJQUxL3V+YN1it0VbeLlABjfT5LcCertk4SdqlhU4KD1ib5gMqdfDepOwRATsHPTcVV9QaRLC+/aIZvT9/ZKIz+jOnsi9QH6hSRBS5K0utQXHX9PP+I0ot2Kfe0tHP3/tePsT3Kt8WEia0DG0tLu1k6JxcJ+4Dz1nuV7QqtnvGu0cHQ=
  file_glob: true
  file: "${TRAVIS_BUILD_DIR}/dist/*.zip"
  skip_cleanup: true
  on:
    tags: true
